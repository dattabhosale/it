<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>About - LeapReplica</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">LeapReplica</a>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
      <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    </div>
  </header>

  <main>
    <section class="container">
      <h1>About LeapReplica</h1>
      <p>LeapReplica is a fictional electric vehicle company created for demonstration purposes. We focus on sustainable mobility, safety and smart vehicle software.</p>
      <h2>Mission</h2>
      <p>To accelerate the transition to sustainable transportation through thoughtful design and engineering.</p>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">© 2025 LeapReplica</div>
  </footer>

  <script src="js/main.js"></script>
  <script type='text/javascript'>
  /**
   * Initialize Salesforce Embedded Messaging with country-specific settings
   */
  function initEmbeddedMessaging() {
    try {
      const countryCode = getCountryCodeFromPath();
      const countryInfo = getCountryInfo(countryCode);
      
      // Configure embedded service settings
      embeddedservice_bootstrap.settings.language = countryInfo.language;
      embeddedservice_bootstrap.settings.shouldOpenLinksInSameTab = true;
      embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
      
      console.log('Detected country code:', countryCode, '| Setting language to:', countryInfo.language);
      
      // Set prechat fields when ready
      window.addEventListener("onEmbeddedMessagingReady", function() {
        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
          Country: countryInfo.name,
          Language: countryInfo.language,
          CountryCode: countryInfo.code,
        });
      });
      
      // Initialize embedded service
      embeddedservice_bootstrap.init(
        "00DMA000003XnGM",
        "LPM_Leapmotor",
        "https://leapmotor--dev01.sandbox.my.site.com/ESWLPMLeapmotor1760706603231",
        {
          scrt2URL: "https://leapmotor--dev01.sandbox.my.salesforce-scrt.com",
        }
      );
    } catch (err) {
      console.error("Error loading Embedded Messaging:", err);
    }
  }
  /**
   * Extract country code from URL pathname
   * @returns {string} Country code (defaults to 'en')
   */
  function getCountryCodeFromPath() {
    const pathParts = window.location.pathname
      .split('/')
      .filter(function(part) { return part.length > 0; });
    
    return pathParts.length > 0 ? pathParts[0].toLowerCase() : 'en';
  }
  /**
   * Get country information based on country code
   * @param {string} countryCode - Two-letter country code
   * @returns {Object} Country information object
   */
  function getCountryInfo(countryCode) {
    const COUNTRY_MAPPING = {
      'it': { name: 'Italy', language: 'it', code: 'it' },
      'es': { name: 'Spain', language: 'es', code: 'es' },
      'fr': { name: 'France', language: 'fr', code: 'fr' },
      'de': { name: 'Germany', language: 'de', code: 'de' },
      'uk': { name: 'United Kingdom', language: 'en_US', code: 'uk' },
      'us': { name: 'United States', language: 'en_US', code: 'us' },
      'en': { name: 'United States', language: 'en_US', code: 'en' }
    };
    
    return COUNTRY_MAPPING[countryCode] || COUNTRY_MAPPING['en'];
  }
  /**
   * Custom Chat Button Module
   * Handles creation and management of custom Leapmotor chat button
   */
  (function() {
    'use strict';
    
    // ============================================================================
    // CONSTANTS
    // ============================================================================
    
    const ELEMENT_IDS = {
      CHAT_BUTTON: 'leap-chat-cta',
      TOGGLE_BUTTON: 'chat-toggle-btn',
      CIRCLE_BUTTON: 'chat-circle-btn',
      STYLES: 'leap-chat-styles'
    };
    
    const BREAKPOINTS = {
      MOBILE: 480,
      TABLET: 768
    };
    
    const TIMING = {
      CAROUSEL_INTERVAL: 3000,
      FADE_DURATION: 500,
      POLLING_INTERVAL: 200,
      MAX_POLLING_ATTEMPTS: 50
    };
    
    const COLORS = {
      PRIMARY: '#64a028',
      WHITE: '#ffffff'
    };
    
    const CAR_MODELS = [
      { name: 'model1', url: 'assets/model1.png' },
      { name: 'model2', url: 'assets/model2.png' },
      { name: 'model3', url: 'assets/model3.png' },
      { name: 'model4', url: 'assets/model4.png' },
      { name: 'model5', url: 'assets/model5.png' }
    ];
    
    const LOCALIZATION = {
      MESSAGES: {
        'it': 'Chatta con me!',
        'es': '¡Chatea conmigo!',
        'fr': 'Discutez avec moi!',
        'de': 'Chatte mit mir!',
        'uk': 'Chat with me!',
        'us': 'Chat with me!',
        'en': 'Chat with me!'
      },
      TOGGLE: {
        'it': { open: 'Massimizza', close: 'Minimizza' },
        'es': { open: 'Maximizar', close: 'Minimizar' },
        'fr': { open: 'Maximiser', close: 'Minimiser' },
        'de': { open: 'Maximieren', close: 'Minimieren' },
        'uk': { open: 'Maximize', close: 'Minimize' },
        'us': { open: 'Maximize', close: 'Minimize' },
        'en': { open: 'Maximize', close: 'Minimize' }
      }
    };
    
    // ============================================================================
    // STATE
    // ============================================================================
    
    const state = {
      chatClicked: false,
      isChatButtonVisible: true,
      embeddedServiceInstance: null,
      currentCarIndex: 0,
      carouselInterval: null,
      countryCode: getCountryCodeFromPath(),
      localization: null,
      lastUsedButton: 'main' // Track which button was used: 'main' or 'circle'
    };
    
    // Initialize localization
    state.localization = {
      message: LOCALIZATION.MESSAGES[state.countryCode] || LOCALIZATION.MESSAGES['en'],
      toggle: LOCALIZATION.TOGGLE[state.countryCode] || LOCALIZATION.TOGGLE['en']
    };
    
    console.log('Detected country:', state.countryCode, '| Message:', state.localization.message);
    
    // ============================================================================
    // UTILITY FUNCTIONS
    // ============================================================================
    
    /**
     * Get responsive positioning based on screen width
     * @returns {Object} Position object with right and bottom values
     */
    function getResponsivePosition(isToggle) {
      const width = window.innerWidth;
      const positions = {
        mobile: { right: '6px', bottom: isToggle ? '95px' : '12px' },
        tablet: { right: '8px', bottom: isToggle ? '100px' : '16px' },
        desktop: { right: '10px', bottom: isToggle ? '105px' : '24px' }
      };
      
      if (width <= BREAKPOINTS.MOBILE) return positions.mobile;
      if (width <= BREAKPOINTS.TABLET) return positions.tablet;
      return positions.desktop;
    }
    
    /**
     * Get circle button position (below toggle button)
     * @returns {Object} Position object with right and bottom values
     */
    function getCircleButtonPosition() {
      const width = window.innerWidth;
      const positions = {
        mobile: { right: '17px', bottom: '12px' },
        tablet: { right: '21px', bottom: '16px' },
        desktop: { right: '25px', bottom: '24px' }
      };
      
      if (width <= BREAKPOINTS.MOBILE) return positions.mobile;
      if (width <= BREAKPOINTS.TABLET) return positions.tablet;
      return positions.desktop;
    }
    
    /**
     * Apply multiple styles to an element
     * @param {HTMLElement} element - Target element
     * @param {Object} styles - Styles object
     */
    function applyStyles(element, styles) {
      Object.keys(styles).forEach(function(key) {
        element.style[key] = styles[key];
      });
    }
    
    /**
     * Create and append stylesheet to document head
     */
    function injectStyles() {
      if (document.getElementById(ELEMENT_IDS.STYLES)) return;
      
      const style = document.createElement('style');
      style.id = ELEMENT_IDS.STYLES;
      style.textContent = `
        @keyframes energyFlow {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }
        
        @keyframes electricPulse {
          0%, 100% { 
            transform: scale(1); 
            box-shadow: 0 12px 32px rgba(0,0,0,0.3), 0 0 40px rgba(0, 150, 255, 0.3); 
          }
          50% { 
            transform: scale(1.02); 
            box-shadow: 0 12px 32px rgba(0,0,0,0.3), 0 0 50px rgba(0, 200, 255, 0.5); 
          }
        }
        
        @keyframes circlePulse {
          0%, 100% { 
            transform: scale(1); 
            box-shadow: 0 8px 24px rgba(0,0,0,0.3), 0 0 30px rgba(100, 160, 40, 0.4); 
          }
          50% { 
            transform: scale(1.05); 
            box-shadow: 0 8px 24px rgba(0,0,0,0.3), 0 0 40px rgba(100, 160, 40, 0.6); 
          }
        }
        
        #${ELEMENT_IDS.CHAT_BUTTON} {
          animation: energyFlow 3s ease infinite, electricPulse 2s ease-in-out infinite;
        }
        
        #${ELEMENT_IDS.CHAT_BUTTON}:hover {
          transform: scale(1.08) !important;
          box-shadow: 0 12px 32px rgba(0,0,0,0.4), 0 0 60px rgba(0, 200, 255, 0.6) !important;
        }
        
        #${ELEMENT_IDS.TOGGLE_BUTTON}:hover {
          background-color: ${COLORS.PRIMARY} !important;
          color: ${COLORS.WHITE} !important;
          transform: scale(1.05) !important;
        }
        
        #${ELEMENT_IDS.CIRCLE_BUTTON} {
          animation: circlePulse 2s ease-in-out infinite;
        }
        
        #${ELEMENT_IDS.CIRCLE_BUTTON}:hover {
          transform: scale(1.1) !important;
          box-shadow: 0 8px 24px rgba(0,0,0,0.4), 0 0 50px rgba(100, 160, 40, 0.7) !important;
        }
      `;
      document.head.appendChild(style);
    }
    
    /**
     * Hide the standard Salesforce chat button
     * @param {Object} es - Embedded service instance
     */
    function hideStandardButton(es) {
      if (!es || !es.utilAPI || typeof es.utilAPI.hideChatButton !== 'function') {
        return;
      }
      
      try {
        es.utilAPI.hideChatButton();
        console.log('Standard chat button hidden');
      } catch (error) {
        console.warn('Error hiding standard chat button:', error);
      }
    }
    
    /**
     * Launch the chat window
     * @param {string} buttonType - Type of button used: 'main' or 'circle'
     */
    function launchChat(buttonType) {
      if (!state.embeddedServiceInstance || 
          !state.embeddedServiceInstance.utilAPI ||
          typeof state.embeddedServiceInstance.utilAPI.launchChat !== 'function') {
        console.warn('launchChat() not available');
        return;
      }
      
      state.chatClicked = true;
      state.lastUsedButton = buttonType || 'main';
      console.log('Launching chat from ' + state.lastUsedButton + ' button...');
      
      const result = state.embeddedServiceInstance.utilAPI.launchChat();
      
      if (result && typeof result.then === 'function') {
        result
          .then(function() {
            console.log('Chat launched successfully');
          })
          .catch(function(error) {
            console.error('Error launching chat:', error);
          });
      }
    }
    
    // ============================================================================
    // CAR CAROUSEL
    // ============================================================================
    
    /**
     * Create car image element with styling
     * @returns {HTMLImageElement} Configured car image element
     */
    function createCarImage() {
      const img = document.createElement('img');
      img.src = CAR_MODELS[0].url;
      img.alt = CAR_MODELS[0].name;
      
      applyStyles(img, {
        width: '100%',
        height: '100%',
        objectFit: 'contain',
        display: 'block',
        transition: 'opacity 0.5s ease, transform 0.3s ease',
        filter: 'drop-shadow(0 3px 8px rgba(0,0,0,0.2)) brightness(1.15) contrast(1.08) saturate(1.1)',
        background: 'rgba(255, 255, 255, 0.15)',
        borderRadius: '16px',
        padding: '8px',
        border: '1px solid rgba(255, 255, 255, 0.2)',
        boxShadow: 'inset 0 1px 2px rgba(255,255,255,0.3)',
        backdropFilter: 'blur(10px)'
      });
      
      return img;
    }
    
    /**
     * Create modern chat icon for circle button
     * @returns {HTMLElement} Configured chat icon element
     */
    function createChatIcon() {
      const iconContainer = document.createElement('div');
      iconContainer.innerHTML = `
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 2H4C2.9 2 2.01 2.9 2.01 4L2 22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" fill="white" opacity="0.95"/>
          <circle cx="7" cy="10" r="1.5" fill="${COLORS.PRIMARY}">
            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0s"/>
          </circle>
          <circle cx="12" cy="10" r="1.5" fill="${COLORS.PRIMARY}">
            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0.2s"/>
          </circle>
          <circle cx="17" cy="10" r="1.5" fill="${COLORS.PRIMARY}">
            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.4s" repeatCount="indefinite" begin="0.4s"/>
          </circle>
        </svg>
      `;
      
      applyStyles(iconContainer, {
        width: '100%',
        height: '100%',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center'
      });
      
      return iconContainer;
    }
    
    /**
     * Start the car carousel animation
     * @param {HTMLImageElement} carImg - Car image element
     */
    function startCarousel(carImg) {
      // Clear any existing interval
      if (state.carouselInterval) {
        clearInterval(state.carouselInterval);
      }
      
      state.carouselInterval = setInterval(function() {
        carImg.style.opacity = '0';
        
        setTimeout(function() {
          state.currentCarIndex = (state.currentCarIndex + 1) % CAR_MODELS.length;
          const nextCar = CAR_MODELS[state.currentCarIndex];
          carImg.src = nextCar.url;
          carImg.alt = nextCar.name;
          carImg.style.opacity = '1';
          console.log('Showing car:', nextCar.name);
        }, TIMING.FADE_DURATION);
      }, TIMING.CAROUSEL_INTERVAL);
    }
    
    /**
     * No carousel needed for circle button - using static icon with CSS animations
     */
    function startCircleCarousel() {
      // Circle button now uses SVG with built-in CSS animations
      // No JavaScript carousel needed
      return;
    }
    
    // ============================================================================
    // BUTTON CREATION
    // ============================================================================
    
    /**
     * Create the main chat button
     * @returns {HTMLButtonElement} Configured chat button
     */
    function createChatButton() {
      const btn = document.createElement('button');
      btn.id = ELEMENT_IDS.CHAT_BUTTON;
      btn.setAttribute('aria-label', state.localization.message);
      
      const position = getResponsivePosition(false);
      
      applyStyles(btn, {
        position: 'fixed',
        right: position.right,
        bottom: position.bottom,
        zIndex: '99999',
        padding: '11px 39px',
        fontSize: '22px',
        fontWeight: '700',
        borderRadius: '999px',
        border: 'none',
        cursor: 'pointer',
        boxShadow: '0 12px 32px rgba(0,0,0,0.3), 0 0 40px rgba(100, 160, 40, 0.4)',
        background: COLORS.PRIMARY,
        backgroundSize: '200% 200%',
        color: COLORS.WHITE,
        display: 'inline-flex',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '18px',
        transition: 'all 0.3s ease',
        overflow: 'visible',
        fontFamily: "'Arial', sans-serif",
        textShadow: '3px 3px 6px rgba(0,0,0,0.4)',
        minWidth: '284px',
        minHeight: '77px'
      });
      
      // Create icon container with car carousel
      const iconContainer = document.createElement('div');
      applyStyles(iconContainer, {
        position: 'relative',
        width: '85px',
        height: '60px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        overflow: 'hidden'
      });
      
      const carImg = createCarImage();
      iconContainer.appendChild(carImg);
      
      // Create text span
      const textSpan = document.createElement('span');
      textSpan.textContent = state.localization.message;
      textSpan.style.letterSpacing = '0.5px';
      
      // Create logo
      const logoImg = document.createElement('img');
      logoImg.src = 'assets/Leapmotor.png';
      logoImg.alt = 'Leapmotor';
      
      applyStyles(logoImg, {
        height: '42px',
        width: 'auto',
        objectFit: 'contain',
        marginLeft: '16px',
        opacity: '1',
        filter: 'drop-shadow(0 3px 10px rgba(0,0,0,0.2)) brightness(1.25) contrast(1.08)',
        background: 'transparent',
        padding: '0',
        borderRadius: '0',
        border: 'none',
        boxShadow: 'none'
      });
      
      // Assemble button
      btn.appendChild(iconContainer);
      btn.appendChild(textSpan);
      btn.appendChild(logoImg);
      
      // Add event listeners
      btn.addEventListener('click', function() {
        launchChat('main');
      });
      btn.addEventListener('mouseenter', function() {
        btn.style.transform = 'scale(1.08)';
      });
      btn.addEventListener('mouseleave', function() {
        btn.style.transform = 'scale(1)';
      });
      
      // Start carousel
      startCarousel(carImg);
      
      return btn;
    }
    
    /**
     * Create the circular chat button
     * @returns {HTMLButtonElement} Configured circular button
     */
    function createCircleButton() {
      const btn = document.createElement('button');
      btn.id = ELEMENT_IDS.CIRCLE_BUTTON;
      btn.setAttribute('aria-label', 'Open chat');
      
      const position = getCircleButtonPosition();
      
      applyStyles(btn, {
        position: 'fixed',
        right: position.right,
        bottom: position.bottom,
        zIndex: '99999',
        width: '70px',
        height: '70px',
        borderRadius: '50%',
        border: 'none',
        cursor: 'pointer',
        boxShadow: '0 8px 24px rgba(0,0,0,0.25), 0 4px 12px rgba(100, 160, 40, 0.3)',
        background: 'linear-gradient(135deg, ' + COLORS.PRIMARY + ' 0%, #7bc043 100%)',
        color: COLORS.WHITE,
        display: 'none',
        alignItems: 'center',
        justifyContent: 'center',
        padding: '0',
        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
        overflow: 'visible',
        fontFamily: "'Arial', sans-serif"
      });
      
      // Create chat icon
      const chatIcon = createChatIcon();
      btn.appendChild(chatIcon);
      
      // Add event listeners
      btn.addEventListener('click', function() {
        launchChat('circle');
      });
      btn.addEventListener('mouseenter', function() {
        btn.style.transform = 'scale(1.1)';
        btn.style.boxShadow = '0 12px 32px rgba(0,0,0,0.3), 0 6px 16px rgba(100, 160, 40, 0.5)';
      });
      btn.addEventListener('mouseleave', function() {
        btn.style.transform = 'scale(1)';
        btn.style.boxShadow = '0 8px 24px rgba(0,0,0,0.25), 0 4px 12px rgba(100, 160, 40, 0.3)';
      });
      
      return btn;
    }
    
    /**
     * Create the toggle button
     * @returns {HTMLButtonElement} Configured toggle button
     */
    function createToggleButton() {
      const toggleBtn = document.createElement('button');
      toggleBtn.id = ELEMENT_IDS.TOGGLE_BUTTON;
      toggleBtn.textContent = state.localization.toggle.close;
      toggleBtn.setAttribute('aria-label', state.localization.toggle.close);
      
      const position = getResponsivePosition(true);
      
      applyStyles(toggleBtn, {
        position: 'fixed',
        right: position.right,
        bottom: position.bottom,
        zIndex: '99999',
        padding: '8px 16px',
        fontSize: '14px',
        fontWeight: '600',
        borderRadius: '20px',
        border: '2px solid ' + COLORS.PRIMARY,
        cursor: 'pointer',
        backgroundColor: COLORS.WHITE,
        color: COLORS.PRIMARY,
        boxShadow: '0 4px 12px rgba(0,0,0,0.2)',
        transition: 'all 0.3s ease',
        fontFamily: "'Arial', sans-serif"
      });
      
      // Toggle functionality
      toggleBtn.addEventListener('click', function() {
        const mainBtn = document.getElementById(ELEMENT_IDS.CHAT_BUTTON);
        const circleBtn = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
        if (!mainBtn) return;
        
        state.isChatButtonVisible = !state.isChatButtonVisible;
        
        if (state.isChatButtonVisible) {
          mainBtn.style.display = 'inline-flex';
          if (circleBtn) circleBtn.style.display = 'none';
          toggleBtn.textContent = state.localization.toggle.close;
          toggleBtn.setAttribute('aria-label', state.localization.toggle.close);
        } else {
          mainBtn.style.display = 'none';
          if (circleBtn) circleBtn.style.display = 'flex';
          toggleBtn.textContent = state.localization.toggle.open;
          toggleBtn.setAttribute('aria-label', state.localization.toggle.open);
        }
      });
      
      return toggleBtn;
    }
    
    // ============================================================================
    // BUTTON VISIBILITY MANAGEMENT
    // ============================================================================
    
    /**
     * Show the custom chat button
     * @param {Object} es - Embedded service instance
     */
    function showCustomCTA(es) {
      if (!es || !es.utilAPI) {
        console.warn('utilAPI not available');
        return;
      }
      
      // Check if button already exists
      const existing = document.getElementById(ELEMENT_IDS.CHAT_BUTTON);
      if (existing) {
        existing.style.display = 'inline-flex';
        const circleBtn = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
        if (circleBtn) circleBtn.style.display = 'none';
        hideStandardButton(es);
        console.log('Custom CTA shown again');
        return;
      }
      
      // Inject styles
      injectStyles();
      
      // Create and append buttons
      const chatButton = createChatButton();
      const toggleButton = createToggleButton();
      const circleButton = createCircleButton();
      
      document.body.appendChild(chatButton);
      document.body.appendChild(toggleButton);
      document.body.appendChild(circleButton);
      
      // Store instance and hide standard button
      state.embeddedServiceInstance = es;
      hideStandardButton(es);
      
      console.log('Custom CTA created with Leapmotor electric car carousel and circle button');
    }
    
    /**
     * Hide the custom chat button
     */
    function hideCustomCTA() {
      const btn = document.getElementById(ELEMENT_IDS.CHAT_BUTTON);
      if (btn) {
        btn.style.display = 'none';
        console.log('Custom CTA hidden');
      }
      
      const circleBtn = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
      if (circleBtn) {
        circleBtn.style.display = 'none';
        console.log('Circle button hidden');
      }
    }
    
    /**
     * Toggle visibility of toggle button
     * @param {boolean} show - Whether to show or hide
     */
    function toggleButtonVisibility(show) {
      const toggleBtn = document.getElementById(ELEMENT_IDS.TOGGLE_BUTTON);
      if (toggleBtn) {
        toggleBtn.style.display = show ? 'block' : 'none';
        console.log('Toggle button ' + (show ? 'shown' : 'hidden'));
      }
    }
    
    // ============================================================================
    // EVENT HANDLERS
    // ============================================================================
    
    /**
     * Handle button created event
     */
    function handleButtonCreated() {
      console.log('onEmbeddedMessagingButtonCreated fired');
      const es = window.embeddedservice_bootstrap;
      if (es) {
        showCustomCTA(es);
      }
    }
    
    /**
     * Handle window maximized event
     */
    function handleWindowMaximized() {
      console.log('onEmbeddedMessagingWindowMaximized fired');
      hideCustomCTA();
      toggleButtonVisibility(false);
    }
    
    /**
     * Handle window minimized event
     */
    function handleWindowMinimized() {
      console.log('onEmbeddedMessagingWindowMinimized fired');
      const es = window.embeddedservice_bootstrap;
      if (es) {
        hideStandardButton(es);
        
        // Show the button that was last used
        const mainBtn = document.getElementById(ELEMENT_IDS.CHAT_BUTTON);
        const circleBtn = document.getElementById(ELEMENT_IDS.CIRCLE_BUTTON);
        
        if (state.lastUsedButton === 'circle') {
          // Show circle button
          if (mainBtn) mainBtn.style.display = 'none';
          if (circleBtn) circleBtn.style.display = 'flex';
          state.isChatButtonVisible = false;
        } else {
          // Show main button
          if (mainBtn) mainBtn.style.display = 'inline-flex';
          if (circleBtn) circleBtn.style.display = 'none';
          state.isChatButtonVisible = true;
        }
        
        toggleButtonVisibility(true);
      }
    }
    
    // ============================================================================
    // INITIALIZATION
    // ============================================================================
    
    /**
     * Poll for embedded service availability
     */
    function waitForEmbeddedService() {
      let attempts = 0;
      
      (function check() {
        attempts++;
        const es = window.embeddedservice_bootstrap;
        
        if (es && es.utilAPI) {
          console.log('utilAPI ready');
          showCustomCTA(es);
          return;
        }
        
        if (attempts >= TIMING.MAX_POLLING_ATTEMPTS) {
          console.warn('utilAPI not found after ' + attempts + ' attempts');
          return;
        }
        
        setTimeout(check, TIMING.POLLING_INTERVAL);
      })();
    }
    
    /**
     * Initialize the custom chat button
     */
    function init() {
      // Register event listeners
      window.addEventListener('onEmbeddedMessagingButtonCreated', handleButtonCreated);
      window.addEventListener('onEmbeddedMessagingWindowMaximized', handleWindowMaximized);
      window.addEventListener('onEmbeddedMessagingWindowMinimized', handleWindowMinimized);
      
      // Start polling for embedded service
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        waitForEmbeddedService();
      } else {
        window.addEventListener('DOMContentLoaded', waitForEmbeddedService);
      }
    }
    
    // Start initialization
    init();
  })();
</script>
<script
  type="text/javascript"
  src="https://leapmotor--dev01.sandbox.my.site.com/ESWLPMLeapmotor1760706603231/assets/js/bootstrap.min.js"
  onload="initEmbeddedMessaging()"
></script>
</body>
</html>
